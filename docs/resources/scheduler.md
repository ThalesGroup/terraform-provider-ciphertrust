---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "ciphertrust_scheduler Resource - terraform-provider-ciphertrust"
subcategory: ""
description: |-
  Creates a new job configuration. The 'database_backup_params', 'cckm_synchronization_params' and 'cckm_key_rotation_params' fields are mutually exclusive, ie: cannot be set simultaneously.
---

# ciphertrust_scheduler (Resource)

Creates a new job configuration. The 'database_backup_params', 'cckm_synchronization_params' and 'cckm_key_rotation_params' fields are mutually exclusive, ie: cannot be set simultaneously.

## Example Usage

```terraform
# Specify the Terraform block to define required providers and their versions.
terraform {
  # Define the required providers for the configuration
  required_providers {
    # CipherTrust provider for managing CipherTrust resources
    ciphertrust = {
      # The source of the provider
      source = "ThalesGroup/CipherTrust"
      # Version of the provider to use
      version = "1.0.0-pre3"
    }
  }
}

# Configure the CipherTrust provider for authentication
provider "ciphertrust" {
	# The address of the CipherTrust appliance (replace with the actual address)
  address = "https://10.10.10.10"

  # Username for authenticating with the CipherTrust appliance
  username = "admin"

  # Password for authenticating with the CipherTrust appliance
  password = "ChangeMe101!"
}


# Define an SCP connection resource with CipherTrust
resource "ciphertrust_scp_connection" "scp_connection" {
  # Name of the SCP connection (unique identifier)
  name = "scp-connection"

  # List of products associated with this SCP connection
  # In this case, it's related to backup/restore operations
  products = [
    "backup/restore"
  ]

  # Description of the SCP connection
  description = "a description of the connection"

  # Host IP address or domain of the SCP server
  host = "10.10.10.10"

  # Port used for SCP communication (default SCP port is 22)
  port = 22

  # Username for authentication on the SCP server
  username = "user"

  # Authentication method to be used, here it's set to "Password"
  auth_method = "Password"

  # Password for the SCP server authentication
  password = "password"

  # Path on the remote server to store or retrieve files
  path_to = "/home/path/to/directory/"

  # Protocol used for SCP connection (can be sftp, scp, etc.)
  protocol = "sftp"

  # Public SSH key for authentication, if using key-based authentication
  public_key = "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDNxnOBfBVU4L3fQBVWK71CdoHXmFNxkD0lFYDagM8etytGxRMQeOSeARUYQA+xC/8ig+LHimQ97L0XPSCvTr/XbXxOYBOdGHFqr1o6QwmSBABoPz0fvfCHaipAdwGlfS50aDbCWYZSd9UX6stOazCPdQ9wiiGD0+wYmagxBtrBlzrXiXKV3q+GNr6iIlejsv2aK"

  # Labels for categorizing the SCP connection
  labels = {
    "environment" = "devenv"
  }

  # Custom metadata for the SCP connection
  # This can be used to store additional information related to the SCP connection
  meta = {
    "custom_meta_key1" = "custom_value1"  # Example custom metadata key-value pair
    "customer_meta_key2" = "custom_value2"  # Another custom metadata entry
  }
}


# Define a resource block to configure a scheduler in CipherTrust.
resource "ciphertrust_scheduler" "scheduler" {
  # Name of the scheduler.
  name = "db_backup1-terraform"
  # Type of operation the scheduler will perform.
  operation = "database_backup"
  # Description of the scheduler.
  description = "This is to backup db updated cancelleed"
  # Specify when the scheduler should run (e.g., "any" for no specific conditions).
  run_on = "any"
  # Cron-style schedule specifying when the job should run. Refer to the schema description to know more about the cron-style
  run_at = "*/15 * * * *"

  # Configuration for the database backup parameters.
  database_backup_params = {
    # Backup ID for the database backup.
    backup_key = "d370535b-a035-4251-9780-e608f713be77"
    # SCP Connection ID for the backup operation.
    connection = ciphertrust_scp_connection.scp_connection.id
    # Description of the backup job.
    description = "sample description"
    # Indicates if SCP should be used for the backup (true in this case).
    do_scp = true
    # Scope of the backup (e.g., "system","domain").
    scope = "system"
    # Indicates if the backup is tied to an HSM (false in this case).
    tied_to_hsm = false
  }
}

# Output block to display details of the created scheduler resource.
output "scheduler" {
  # Outputs all attributes of the scheduler resource.
  value = ciphertrust_scheduler.scheduler
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `name` (String) The name of the job configuration.
- `operation` (String) The operation field specifies the type of operation to be performed. Currently, only database_backup, cckm_key_rotation, cckm_synchronization, cckm_xks_credential_rotation are supported.
- `run_at` (String) Described using the cron expression format : "* * * * *" These five values indicate when the job should be executed. They are in order of minute, hour, day of month, month, and day of week. Valid values are 0-59 (minutes), 0-23 (hours), 1-31 (day of month), 1-12 or jan-dec (month), and 0-6 or sun-sat (day of week). Names are case insensitive. For use of special characters, consult the Time Specification description at the top of this page.

For example:

    To run every min: "* * * * *"
    To run on Saturday at 23:45(11:45 PM): "45 23 * * 6"
    To run on Monday at 09:00: "0 9 * * 1"

### Optional

- `cckm_key_rotation_params` (Block List) Specifies cloud key rotation parameters (see [below for nested schema](#nestedblock--cckm_key_rotation_params))
- `cckm_synchronization_params` (Block List) Cloud key synchronization parameters. (see [below for nested schema](#nestedblock--cckm_synchronization_params))
- `cckm_xks_credential_rotation_params` (Attributes) CCKM XKS credential rotation operation specific arguments. (see [below for nested schema](#nestedatt--cckm_xks_credential_rotation_params))
- `database_backup_params` (Attributes) Database backup operation specific arguments. Should be JSON-serializable. Required only for "database_backup" operations. Not allowed for other operations. (see [below for nested schema](#nestedatt--database_backup_params))
- `description` (String) Description for the job configuration.
- `disabled` (Boolean) By default, the job configuration starts in an active state. True disables the job configuration.
- `end_date` (String) Date the job configuration becomes inactive. RFC3339 format. For example, 2018-10-02T14:24:37.436073Z
- `run_on` (String) Default is 'any'. For database_backup, the default will be the current node if in a cluster.
- `start_date` (String) Date the job configuration becomes active. RFC3339 format. For example, 2018-10-02T14:24:37.436073Z

### Read-Only

- `account` (String)
- `application` (String)
- `created_at` (String)
- `dev_account` (String)
- `id` (String) The ID of this resource.
- `updated_at` (String)
- `uri` (String)

<a id="nestedblock--cckm_key_rotation_params"></a>
### Nested Schema for `cckm_key_rotation_params`

Required:

- `cloud_name` (String) Name of the cloud for which to schedule the key rotation. Options are: aws,oci.

Optional:

- `aws_retain_alias` (Boolean) Retain the alias and timestamp on the archived key after rotation. Applicable only to AWS key rotation.
- `expiration` (String) Expiration time of the new key. If not specified, the new key material never expires. For example, if you want the scheduler to the rotate keys that are expiring within six hours of its run, set expire_in to 6h. Use either 'Xd' for x days or 'Yh' for y hours.
- `expire_in` (String) Period during which certain keys are going to expire. The scheduler rotates the keys that are expiring in this period. If not specified, the scheduler rotates all the keys. For example, if you want the scheduler to rotate the keys that are expiring within six hours of its run, set expire_in to 6h. Use either 'Xd' for x days or 'Yh' for y hours.
- `rotate_material` (Boolean) If true, rotate the key material during the key rotation job.


<a id="nestedblock--cckm_synchronization_params"></a>
### Nested Schema for `cckm_synchronization_params`

Required:

- `cloud_name` (String) Specify the cloud that will be synchronized on schedule. Options are: aws,oci.

Optional:

- `kms` (Set of String) A list of kms resource ID's for which AWS keys will be synchronized. Unless synchronizing all AWS keys, at least one kms is required.
- `oci_vaults` (Set of String) A list OCI vaults resource ID's for which OCI keys will be synchronized. Unless synchronizing all OCI keys, at least one vaults is required.
- `synchronize_all` (Boolean) Set true to synchronize all keys.


<a id="nestedatt--cckm_xks_credential_rotation_params"></a>
### Nested Schema for `cckm_xks_credential_rotation_params`

Optional:

- `cloud_name` (String) Name of the cloud in which the Rotation operation will be triggered. The only supported value is 'aws'.


<a id="nestedatt--database_backup_params"></a>
### Nested Schema for `database_backup_params`

Optional:

- `backup_key` (String) ID of backup key used for encrypting the backup. The default backup key is used if this is not specified.
- `connection` (String) Name or ID of the SCP connection which stores the details for SCP server.
- `description` (String) User defined description associated with the backup. This is stored along with the backup, and is returned while retrieving the backup information, or while listing backups. Users may find it useful to store various types of information here: a backup name or description, ID of the HSM the backup is tied to, etc.
- `do_scp` (Boolean) If true, the system backup will also be transferred to the external server via SCP.
- `filters` (Attributes List) A set of selection criteria to specify what resources to include in the backup. Only applicable to domain-scoped backups. By default, no filters are applied and the backup includes all keys. For example, to back up all keys with a name containing 'enc-key', set the filters to [{"resourceType": "Keys", "resourceQuery":{"name":"*enc-key*"}}]. (see [below for nested schema](#nestedatt--database_backup_params--filters))
- `retention_count` (Number) Number of backups saved for this job config. Default is an unlimited quantity.
- `scope` (String) Scope of the backup to be taken - system (default) or domain.
- `tied_to_hsm` (Boolean) If true, the system backup can only be restored to instances that use the same HSM partition. Valid only with the system scoped backup.

<a id="nestedatt--database_backup_params--filters"></a>
### Nested Schema for `database_backup_params.filters`

Required:

- `resource_type` (String) Type of resources to be backed up. Valid values are "Keys", "cte_policies", "customer_fragments" and, "users_groups".

Optional:

- `resource_query` (String) A JSON object containing resource attributes and attribute values to be queried. The resources returned in the query are backed up. If empty, all the resources of the specified resourceType will be backed up. For Keys, valid resourceQuery paramater values are the same as the body of the 'vault/query-keys' POST endpoint described on the Keys page. If multiple parameters of 'vault/query-keys' are provided then the result will be AND of all. To back up AES keys with a meta parameter value containing {"info":{"color":"red"}}}, use {"algorithm":"AES", "metaContains": {"info":{"color":"red"}}}. To backup specific keys using names, use {"names":["key1", "key2"]}.

For CTE policies, valid resourceQuery parameter values are the same as query parameters of the list '/v1/transparent-encryption/policies' endpoint described in the CTE > Policies section. For example, to back up LDT policies only, use {"policy_type":"LDT"}. Similarly, to back up policies with learn mode enabled, use {"never_deny": true}. For users, the valid resourceQuery parameter values are the same as query parameters of the list '/v1/usermgmt/users' endpoint as described in the “Users” page. For example, to back up all users with name "frank" and email id "frank@local", use {"name":"frank","email": "frank@local"}.

For Customer fragments, valid resourceQuery parameter values are 'ids' and 'names' of Customer fragments. To backup specific customer fragments using ids, use {"ids":["370c4373-2675-4aa1-8cc7-07a9f95a5861", "4e1b9dec-2e38-40d7-b4d6-244043200546"]}. To backup specific customer fragments using names, use {"names":["customerFragment1", "customerFragment2"]}.

Note: When providing resource_query as a JSON string, ensure proper escaping of special characters like quotes (") and use \n for line breaks if entering the JSON in multiple lines.
For example: "{\"ids\": ["56fc2127-3a96-428e-b93b-ab169728c23c", "a6c8d8eb-1b69-42f0-97d7-4f0845fbf602"]}"
