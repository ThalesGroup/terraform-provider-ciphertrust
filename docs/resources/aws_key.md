---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "ciphertrust_aws_key Resource - terraform-provider-ciphertrust"
subcategory: ""
description: |-
  Use this resource to create and manage AWS keys in CipherTrust Manager.
---

# ciphertrust_aws_key (Resource)

Use this resource to create and manage AWS keys in CipherTrust Manager.

## Example Usage

```terraform
# Pre-requisites for AWS keys - AWS connection, AWS KMS
# Define an AWS connection
resource "ciphertrust_aws_connection" "aws-connection" {
  name = "aws-connection-name"
}
output "aws_connection_id" {
  value = ciphertrust_aws_connection.aws-connection.id
}

# Get the AWS account details
data "ciphertrust_aws_account_details" "account_details" {
  aws_connection = ciphertrust_aws_connection.aws-connection.id
}

# Define a kms
resource "ciphertrust_aws_kms" "kms" {
  depends_on = [
    ciphertrust_aws_connection.aws-connection,
  ]
  account_id     = data.ciphertrust_aws_account_details.account_details.account_id
  aws_connection = ciphertrust_aws_connection.aws-connection.id
  name           = "kms-name"
  regions        = data.ciphertrust_aws_account_details.account_details.regions
}

resource "ciphertrust_scheduler" "scheduled_rotation" {
  cckm_key_rotation_params {
    cloud_name       = "aws"
    expiration       = "2d"
    aws_retain_alias = true
  }
  name      = "scheduler-name"
  operation = "cckm_key_rotation"
  run_at    = "0 9 * * sat"
  run_on    = "any"
}

# Define a 2048 bit RSA AWS key
resource "ciphertrust_aws_key" "aws_key" {
  kms    = ciphertrust_aws_kms.kms.id
  region = ciphertrust_aws_kms.kms.regions[0]
}

# Define an AES CipherTrust key to upload to AWS
resource "ciphertrust_cm_key" "cm_key" {
  name      = "cm-key-name"
  algorithm = "aes"
}

# Upload an existing CipherTrust key to AWS
resource "ciphertrust_aws_key" "upload_aws_key" {
  kms    = ciphertrust_aws_kms.kms.id
  region = ciphertrust_aws_kms.kms.regions[0]
  upload_key {
    source_key_identifier = ciphertrust_cm_key.cm_key.id
  }
}

# Define a new CipherTrust key and import its key material to a new AWS key
resource "ciphertrust_aws_key" "import_aws_key" {
  import_key_material {
    source_key_name = "key-name"
  }
  kms    = ciphertrust_aws_kms.kms.id
  region = ciphertrust_aws_kms.kms.regions[0]
}

# Define a multi-region key
resource "ciphertrust_aws_key" "aws_multiregion_key" {
  kms          = ciphertrust_aws_kms.kms.id
  multi_region = true
  region       = ciphertrust_aws_kms.kms.regions[0]
  enable_rotation {
    disable_encrypt = false
    job_config_id   = ciphertrust_scheduler.scheduled_rotation.id
    key_source      = "ciphertrust"
  }
}

# Replicate the above key and make the replica the primary key
resource "ciphertrust_aws_key" "replicated_key" {
  region = ciphertrust_aws_kms.kms.regions[1]
  replicate_key {
    key_id       = ciphertrust_aws_key.aws_multiregion_key.key_id
    make_primary = true
  }
}

# Define an AWS multi-region key and import its key material from a CipherTrust key
resource "ciphertrust_aws_key" "aws_external_multiregion_key" {
  import_key_material {
    source_key_name = "cm-key-name"
  }
  kms          = ciphertrust_aws_kms.kms.id
  multi_region = true
  region       = ciphertrust_aws_kms.kms.regions[0]
}

# Replicate the above key to another region and import the same key material to the replica
resource "ciphertrust_aws_key" "external_replicated_key" {
  region = ciphertrust_aws_kms.kms.regions[1]
  replicate_key {
    import_key_material = true
    key_id              = ciphertrust_aws_key.aws_external_multiregion_key.key_id
  }
}

# Define am AWS key and enable autorotation by AWS
resource "ciphertrust_aws_key" "auto_rotated_aws_key" {
  kms                          = ciphertrust_aws_kms.kms.id
  region                       = ciphertrust_aws_kms.kms.regions[0]
  auto_rotate                  = true
  auto_rotation_period_in_days = 128
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `region` (String) AWS region in which to create the AWS key.

### Optional

- `alias` (Set of String) (Updatable) Alias(es) of the key. To allow for key rotation changing or removing original aliases, all aliases already assigned to another key will be ignored.
- `auto_rotate` (Boolean) (Updatable) Enable AWS autorotation of the key. Auto-Rotation only is only applicable to native symmetric keys.
- `auto_rotation_period_in_days` (Number) Rotation period in days. Optional parameter for auto_rotate. Must be at least 90 days.
- `bypass_policy_lockout_safety_check` (Boolean) Whether to bypass the key policy lockout safety check.
- `customer_master_key_spec` (String) Whether the KMS key contains a symmetric key or an asymmetric key pair. Valid values: SYMMETRIC_DEFAULT, RSA_2048, RSA_3072, RSA_4096, ECC_NIST_P256, ECC_NIST_P384, ECC_NIST_P521, ECC_SECG_P256K1, HMAC_224, HMAC_256, HMAC_384, HMAC_512. Default is SYMMETRIC_DEFAULT.
- `description` (String) (Updatable) Description of the AWS key. Descriptions can be updated but not removed.
- `enable_key` (Boolean) (Updatable) Enable or disable the key. Default is true.
- `enable_rotation` (Block List) (Updatable) Enable the key for scheduled rotation job. Parameters 'disable_encrypt' and 'disable_encrypt_on_all_accounts' are mutually exclusive (see [below for nested schema](#nestedblock--enable_rotation))
- `import_key_material` (Block List) Both a 'source_key_tier' key and an AWS external key will be created. Key material from the 'source_key_tier' key will be imported to the AWS key.The 'source_key_tier' key will not be deleted on Terraform destroy. An alternative is to use 'upload_key' parameter. (see [below for nested schema](#nestedblock--import_key_material))
- `key_policy` (Block List) (Updatable) Key policy parameters. (see [below for nested schema](#nestedblock--key_policy))
- `key_usage` (String) Specifies the intended use of the key. Options are ENCRYPT_DECRYPT, SIGN_VERIFY and GENERATE_VERIFY_MAC.Default for RSA keys is ENCRYPT_DECRYPT,default for EC keys is SIGN_VERIFY, default for symmetric keys is ENCRYPT_DECRYPT and default for HMAC keys is GENERATE_VERIFY_MAC.
- `kms` (String) Name or ID of the KMS to be used to create the key. Required unless replicating a multi-region key.
- `multi_region` (Boolean) Creates or identifies a multi-region key.
- `origin` (String) Source of the key material. Options: AWS_KMS, EXTERNAL. AWS_KMS will create a native AWS key and is the default for AWS native key creation. EXTERNAL will create an external AWS key and is the default for import operations. This parameter is not required for upload operations.
- `primary_region` (String) (Updatable) Updates the primary region of a multi-region key.
- `replicate_key` (Block List) Replicate key parameters. (see [below for nested schema](#nestedblock--replicate_key))
- `schedule_for_deletion_days` (Number) (Updatable) Waiting period after the key is destroyed before the key is deleted. Only relevant when the resource is destroyed. Default is 7.
- `tags` (Map of String) (Updatable) A list of tags assigned to the AWS key.
- `upload_key` (Block List) Key material from the 'source_key_tier' will be uploaded to an external AWS key. (see [below for nested schema](#nestedblock--upload_key))

### Read-Only

- `arn` (String) The Amazon Resource Name (ARN) of the key.
- `aws_account_id` (String) AWS account ID.
- `aws_key_id` (String) AWS key ID.
- `cloud_name` (String) AWS cloud.
- `created_at` (String) Date the key was created.
- `deletion_date` (String) Date the key is scheduled for deletion.
- `enabled` (Boolean) True if the key is enabled.
- `encryption_algorithms` (List of String) Encryption algorithms of an asymmetric key
- `expiration_model` (String) Expiration model.
- `external_accounts` (Set of String) Other AWS accounts that have access to this key.
- `id` (String) AWS region and AWS key identifier separated by a backslash.
- `key_admins` (Set of String) Key administrators - users.
- `key_admins_roles` (Set of String) Key administrators - roles.
- `key_id` (String) CipherTrust Manager Key ID.
- `key_manager` (String) Key manager.
- `key_material_origin` (String) Key material origin.
- `key_rotation_enabled` (Boolean) True if rotation is enabled in AWS for this key.
- `key_source` (String) Source of the key.
- `key_state` (String) Key state.
- `key_type` (String) Key type.
- `key_users` (Set of String) Key users - users.
- `key_users_roles` (Set of String) Key users - roles.
- `kms_id` (String) ID of the KMS
- `labels` (Map of String) A list of key:value pairs associated with the key.
- `local_key_id` (String) CipherTrust Manager key identifier of the external key.
- `local_key_name` (String) CipherTrust Manager key name of the external key.
- `multi_region_key_type` (String) Indicates if the key is the primary key or a replica key.
- `multi_region_primary_key` (Map of String)
- `multi_region_replica_keys` (List of Map of String)
- `next_rotation_date` (String) Date when auto-rotation will happen next.
- `policy` (String) AWS key policy.
- `policy_template_tag` (Map of String) AWS key tag for an associated policy template.
- `replica_policy` (String) Replication policy.
- `rotated_at` (String) Time when this key was rotated by a scheduled rotation job.
- `rotated_from` (String) CipherTrust Manager key ID from of the key this key has been rotated from by a scheduled rotation job.
- `rotated_to` (String) CipherTrust Manager key ID which this key has been rotated too by a scheduled rotation job.
- `rotation_status` (String) Rotation status of the key.
- `synced_at` (String) Date the key was synchronized.
- `updated_at` (String) Date the key was last updated.
- `valid_to` (String) Date of key material expiry.

<a id="nestedblock--enable_rotation"></a>
### Nested Schema for `enable_rotation`

Required:

- `job_config_id` (String) ID of the scheduler configuration job that will schedule the key rotation.
- `key_source` (String) Key source from where the key will be uploaded. Currently, the only option is 'ciphertrust'.

Optional:

- `disable_encrypt` (Boolean) Disable encryption on the old key.
- `disable_encrypt_on_all_accounts` (Boolean) Disable encryption permissions on the old key for all the accounts


<a id="nestedblock--import_key_material"></a>
### Nested Schema for `import_key_material`

Required:

- `source_key_name` (String) Name of the key created for key material.

Optional:

- `key_expiration` (Boolean) Enable key material expiration.
- `source_key_tier` (String) Source of the key material. Current option is 'local' implying a CipherTrust Manager key. Default is 'local'.
- `valid_to` (String) Date of key material expiry in UTC time in RFC3339 format. For example, 2027-07-03T14:24:00Z.


<a id="nestedblock--key_policy"></a>
### Nested Schema for `key_policy`

Optional:

- `external_accounts` (Set of String) Other AWS accounts that can access to the key.
- `key_admins` (Set of String) Key administrators - users.
- `key_admins_roles` (Set of String) Key administrators - roles.
- `key_users` (Set of String) Key users - users.
- `key_users_roles` (Set of String) Key users - roles.
- `policy` (String) AWS key policy json.
- `policy_template` (String) CipherTrust Manager policy template ID


<a id="nestedblock--replicate_key"></a>
### Nested Schema for `replicate_key`

Required:

- `key_id` (String) CipherTrust Manager key ID of the key to replicate.

Optional:

- `import_key_material` (Boolean) Import primary key material to the replicated key. Applies to external AWS keys.
- `key_expiration` (Boolean) Enable key expiration of the replicated key. Applies to external AWS keys.
- `make_primary` (Boolean) Update the primary key region to the replicated key's region following replication.
- `valid_to` (String) Date the key material of the replicated key expires. Applies to external AWS keys. Set as UTC time in RFC3339 format. For example, 2027-07-03T14:24:00Z.


<a id="nestedblock--upload_key"></a>
### Nested Schema for `upload_key`

Required:

- `source_key_identifier` (String) CipherTrust Manager key ID to upload to AWS.

Optional:

- `key_expiration` (Boolean) Enable key expiration.
- `source_key_tier` (String) Source of the key material. Current option is 'local' implying a CipherTrust Manager key. Default is 'local'.
- `valid_to` (String) Date of key expiry in UTC time in RFC3339 format. For example, 2027-07-03T14:24:00Z. Only valid if 'key_expiration' is true.
